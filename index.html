<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Buscador de Equivalencias de Filamento</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      margin-bottom: 10px;
    }

    select {
      margin-right: 10px;
      padding: 6px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      font-size: 13px;
      vertical-align: middle;
    }

    th {
      background: #f2f2f2;
      text-align: left;
    }

    .swatch {
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-right: 6px;
      border: 1px solid #999;
      vertical-align: middle;
    }
  </style>
</head>
<body>

<h1>Equivalencias de Filamento</h1>

<!-- Filtros -->
<div>
  <select id="brandSelect"></select>
  <select id="colorSelect"></select>
  <select id="materialSelect"></select>
</div>

<!-- Tabla -->
<div id="table-container"></div>

<script>
/* ============================
   CONFIG
============================ */
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSqQ7ZocXOFSN_kojnrH3dHhf2uHmQ2uFVVcG9FYNlbGg8YiTuS5piDSGyZ3-1P8hVUPcpazMHyOf18/pub?output=csv";

/* ============================
   STATE
============================ */
let rawData = [];
let headers = [];

/* ============================
   COLOR MAP (SWATCHES)
============================ */
const colorMap = {
  Red: "#c62828",
  Scarlet: "#d32f2f",
  Burgundy: "#6d1b1b",
  DarkRed: "#8e0000",
  Orange: "#ef6c00",
  Yellow: "#fbc02d",
  Green: "#2e7d32",
  Blue: "#1565c0",
  Black: "#212121",
  White: "#fafafa",
  Gray: "#9e9e9e"
};

function getSwatchColor(colorName) {
  return colorMap[colorName] || "#cccccc";
}

/* ============================
   INIT
============================ */
fetch(CSV_URL)
  .then(res => res.text())
  .then(text => {
    rawData = text.trim().split("\n").map(r => r.split(","));
    headers = rawData.shift(); // Primera fila = headers
    initFilters();
    applyFilters();
  });

/* ============================
   FILTERS
============================ */
function initFilters() {
  const brandSelect = document.getElementById("brandSelect");
  const colorSelect = document.getElementById("colorSelect");
  const materialSelect = document.getElementById("materialSelect");

  // Marca base
  brandSelect.innerHTML = `<option value="">Marca base</option>`;
  headers.forEach(h => {
    brandSelect.innerHTML += `<option value="${h}">${h}</option>`;
  });

  // Color
  const colors = [...new Set(rawData.map(r => r[0]).filter(Boolean))];
  colorSelect.innerHTML = `<option value="">Color</option>`;
  colors.forEach(c => {
    colorSelect.innerHTML += `<option value="${c}">${c}</option>`;
  });

  // Material
  const materials = [...new Set(rawData.map(r => r[1]).filter(Boolean))];
  materialSelect.innerHTML = `<option value="">Material</option>`;
  materials.forEach(m => {
    materialSelect.innerHTML += `<option value="${m}">${m}</option>`;
  });

  brandSelect.onchange =
  colorSelect.onchange =
  materialSelect.onchange = applyFilters;
}

function applyFilters() {
  const brand = document.getElementById("brandSelect").value;
  const color = document.getElementById("colorSelect").value;
  const material = document.getElementById("materialSelect").value;

  let filtered = rawData;

  if (color) {
    filtered = filtered.filter(r => r[0] === color);
  }

  if (material) {
    filtered = filtered.filter(r => r[1] === material);
  }

  renderTable(filtered, brand);
}

/* ============================
   TABLE RENDER
============================ */
function renderTable(data, brand) {
  const table = document.createElement("table");

  // Columnas visibles (sin huecos)
  const visibleColumns = headers
    .map((h, i) => ({ h, i }))
    .filter(col => {
      if (col.i < 2) return true; // Color + Material
      if (!brand) return true;
      if (col.h === brand) return true;
      return data.some(row => row[col.i]);
    });

  // Marca base primero
  if (brand) {
    visibleColumns.sort((a, b) => {
      if (a.h === brand) return -1;
      if (b.h === brand) return 1;
      return 0;
    });
  }

  // Header
  const thead = document.createElement("tr");
  visibleColumns.forEach(col => {
    const th = document.createElement("th");
    th.textContent = col.h;
    thead.appendChild(th);
  });
  table.appendChild(thead);

  // Rows
  data.forEach(row => {
    const tr = document.createElement("tr");

    visibleColumns.forEach(col => {
      const td = document.createElement("td");

      // Color swatch solo en columna Color
      if (col.i === 0) {
        const swatch = document.createElement("span");
        swatch.className = "swatch";
        swatch.style.backgroundColor = getSwatchColor(row[col.i]);

        td.appendChild(swatch);
        td.appendChild(document.createTextNode(row[col.i]));
      } else {
        td.textContent = row[col.i] || "";
      }

      tr.appendChild(td);
    });

    table.appendChild(tr);
  });

  const container = document.getElementById("table-container");
  container.innerHTML = "";
  container.appendChild(table);
}
</script>

</body>
</html>
